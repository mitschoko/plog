doctype 5
html
  head
    title= title
    link(rel='stylesheet', href='/stylesheets/style.css') 
    script(type='text/javascript', src='/javascripts/jquery.min.js')
    script(type='text/javascript', src='/faye.js')
    :coffeescript
      $(document).ready ->
        window.resizeSimles = ( x ) ->
          $("svg.smile .main").attr "transform", "scale( #{ x })"
        window.silent = ->
          $(".speak").toggle( "unused" )      
        faye = new Faye.Client "/faye" 
        faye.subscribe "/update/posts", ( msg ) ->
          jQuery.ajax
            url: "/post/#{msg}"
            contentType: "text/html"
            success: ( data ) ->
              $("#posts").prepend data
              $("#newPost .bubble").val "" 
              $("#newPost .speak").addClass("unused")
        $("#saySomething").click -> $("#newPost .speak").toggleClass( "unused" )
        $("#sendPost").click ->
          smile = saveSmile()
          smile.text = $("#newPost .speak textarea").val() if not $("#postText.speak").hasClass("unused")
          console.log smile
          $.ajax 
            url: "/post"
            type: "POST"
            data:
              smile: smile
    include head 
    -if ( user && user.is_author )
      #newPost.post
        include smileEditor
        include smile
        #postText.speak.unused
          svg.arrow
            polyline( stroke="black", stroke-width=2, fill="white", points="63,40 0,0 63,60") 
          textarea.bubble
        .postControls
          button#saySomething Speak!
          button#sendPost Commit 
    include timeAxis   
